@page
@model Bank.Pages.Customers.CustomerModel
@{
    ViewData["Title"] = "Customer";
}

<head>
    <link href="~/css/styles.css" rel="stylesheet" />
</head>

<!-- Masthead-->
<header class="masthead pt-5 bg-black">
    <div class="container px-4 d-flex h-auto align-items-center justify-content-center">
        <div class="justify-content-center pt-200">



            <div class="text-center">
                <h1 class="display-4 pt-5">@Model.SingleCustomer.Givenname @Model.SingleCustomer.Surname </h1>

                <div class=" m-3">
                    <a asp-page="/Customers/EditCustomer"
                       asp-route-customerId="@Model.SingleCustomer.CustomerId"
                       class="btn btn-sm btn-primary">
                        Edit Customer
                    </a>
                </div>


                @*Customer information table*@
                <table class="table table-striped table-dark">
                    <tbody>
                        <tr>
                            <th scope="col">Customer Id</th>
                            <td>@Model.SingleCustomer.CustomerId</td>
                        </tr>
                        <tr>
                            <th scope="col">Birthdate</th>
                            <td>@Model.SingleCustomer.Birthday</td>
                        </tr>
                        <tr>
                            <th scope="col">National Id</th>
                            <td>@Model.SingleCustomer.NationalId</td>
                        </tr>
                        <tr>
                            <th scope="col">Address</th>
                            <td>
                                @Model.SingleCustomer.Streetaddress @Model.SingleCustomer.Zipcode <br />
                                @Model.SingleCustomer.City, @Model.SingleCustomer.Country
                            </td>
                        </tr>
                        <tr>
                            <th scope="col">Contact Info</th>
                            <td>
                                <i class="fa-regular fa-envelope"></i> @Model.SingleCustomer.Emailaddress <br />
                                <i class="fa-solid fa-mobile-screen-button"></i>
                                +@Model.SingleCustomer.Telephonecountrycode @Model.SingleCustomer.Telephonenumber
                            </td>
                        </tr>
                        <tr>
                            <th scope="col">Number of accounts </th>
                            <td>
                                @Model.NumberOfAccounts
                            </td>
                        </tr>
                        <tr>
                            <th scope="col">Total account balance</th>
                            <td>
                                @Model.Balance
                            </td>
                        </tr>
                    </tbody>
                </table>


                @*Accounts table*@
                <table class="table table-striped table-dark">
                    <thead>
                        <tr>
                            <th colspan="5"><h3>Accounts</h3></th>
                        </tr>
                        <tr>
                            <th scope="col">AccountId</th>
                            <th scope="col">Frequency</th>
                            <th scope="col">Created</th>
                            <th scope="col">Balance</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>

                        @foreach(var account in Model.Accounts)
                        {
                            <tr>
                                <td>@account.AccountId</td>                       
                                <td>@account.Frequency</td>                         
                                <td>@account.Created</td>                          
                                <td>@account.Balance</td>                            
                                <td><a asp-page="/Accounts/Account" asp-route-accountId="@account.AccountId" class="btn btn-sm btn-primary">View</a></td>
                            </tr>
                        }                        
                    </tbody>
                </table>

                @*Transactions table*@
                <table class="table table-striped table-dark" id="posts-table">
                    <thead>
                        <tr>
                            <th colspan="5"><h3>Transactions</h3></th>
                        </tr>
                        <tr>
                            <th scope="col">Amount</th>
                            <th scope="col">Type</th>
                            <th scope="col">Balance</th>
                            <th scope="col">Date</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
                <a class="btn btn-secondary" href="javascript:showMore();">Show More</a>
            </div>
        </div>
    </div>
</header>


@section Scripts
    {
    <script>
        pageNum = 1;
        CustomerId = @Model.SingleCustomer.CustomerId;
        document.addEventListener("DOMContentLoaded", function () {
            showMore();
        });
        function showMore() {
            //pagenum och customerid är känsliga och behöver heta samma som i din onget
            fetch(`/Customers/Customer?handler=ShowMore&customerId=${CustomerId}&pageNum=${pageNum}`)
                .then((response) => response.json())
                .then((json) => {
                    console.log('JSON data:', json); //visar om du får nån json data F12 console.log
                    pageNum = pageNum + 1;
                    json.transactions.forEach(drawElements);
                })
                .catch((error) => console.log(error)); //error loggning
        }
        function drawElements(element) {
            console.log('Element:', element); //kollar om den får sina element
             document.querySelector('#posts-table tbody').innerHTML +=
                `<tr>
                    <td>${element.amount}</td>
                    <td>${element.type}</td>
                    <td>${element.balance}</td>
                    <td>${element.date}</td>
                    <td>
                        <a class="btn btn-primary" onclick="fetchEvaluation(${element.transactionId}, this)">
                            Show Value
                        </a>
                    </td>
                </tr>`;
        }
    </script>
}
